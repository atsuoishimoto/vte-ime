Ubuntu: https://bugs.launchpad.net/bugs/106995
Upstream: http://bugzilla.gnome.org/show_bug.cgi?id=538195
Description: Handle scrolling differently when using alternate screen or
 scrolling is restricted.

diff -Nur -x '*.orig' -x '*~' vte/doc/reference/xml/vte.xml vte.new/doc/reference/xml/vte.xml
--- vte/doc/reference/xml/vte.xml	2008-08-13 17:03:32.000000000 -0700
+++ vte.new/doc/reference/xml/vte.xml	2008-08-28 09:23:40.000000000 -0700
@@ -68,6 +68,9 @@
 <link linkend="void">void</link>                <link linkend="vte-terminal-set-scroll-on-keystroke">vte_terminal_set_scroll_on_keystroke</link>
                                                         (<link linkend="VteTerminal">VteTerminal</link> *terminal,
                                                          <link linkend="gboolean">gboolean</link> scroll);
+<link linkend="void">void</link>                <link linkend="vte-terminal-set-scroll-on-keystroke">vte_terminal_set_alternate_screen_scroll</link>
+                                                        (<link linkend="VteTerminal">VteTerminal</link> *terminal,
+                                                         <link linkend="gboolean">gboolean</link> scroll);
 <link linkend="void">void</link>                <link linkend="vte-terminal-set-color-bold">vte_terminal_set_color_bold</link>         (<link linkend="VteTerminal">VteTerminal</link> *terminal,
                                                          const <link linkend="GdkColor">GdkColor</link> *bold);
 <link linkend="void">void</link>                <link linkend="vte-terminal-set-color-foreground">vte_terminal_set_color_foreground</link>   (<link linkend="VteTerminal">VteTerminal</link> *terminal,
diff -Nur -x '*.orig' -x '*~' vte/src/vte.c vte.new/src/vte.c
--- vte/src/vte.c	2008-08-28 09:23:34.000000000 -0700
+++ vte.new/src/vte.c	2008-08-28 09:23:40.000000000 -0700
@@ -10729,8 +10729,9 @@
 		return FALSE;
 	}
 
-	if (terminal->pvt->screen == &terminal->pvt->alternate_screen ||
-		terminal->pvt->normal_screen.scrolling_restricted) {
+	if (terminal->pvt->alternate_screen_scroll &&
+		(terminal->pvt->screen == &terminal->pvt->alternate_screen ||
+		terminal->pvt->normal_screen.scrolling_restricted)) {
 		char *normal;
 		gssize normal_length;
 		const gchar *special;
@@ -11356,6 +11357,22 @@
 	terminal->pvt->scroll_on_keystroke = scroll;
 }
 
+/**
+ * vte_terminal_set_alternate_screen_scroll:
+ * @terminal: a #VteTerminal
+ * @scroll: %TRUE if the terminal should send keystrokes for scrolling when using alternate screen
+ *
+ * Controls whether or not the terminal will send keystrokes for scrolling
+ * when using alternate screen or scrolling is restricted.
+ *
+ */
+void
+vte_terminal_set_alternate_screen_scroll(VteTerminal *terminal, gboolean scroll)
+{
+	g_return_if_fail(VTE_IS_TERMINAL(terminal));
+	terminal->pvt->alternate_screen_scroll = scroll;
+}
+
 static void
 vte_terminal_real_copy_clipboard(VteTerminal *terminal)
 {
diff -Nur -x '*.orig' -x '*~' vte/src/vte.h vte.new/src/vte.h
--- vte/src/vte.h	2008-06-29 09:48:34.000000000 -0700
+++ vte.new/src/vte.h	2008-08-28 09:23:40.000000000 -0700
@@ -256,6 +256,8 @@
 void vte_terminal_set_scroll_on_output(VteTerminal *terminal, gboolean scroll);
 void vte_terminal_set_scroll_on_keystroke(VteTerminal *terminal,
 					  gboolean scroll);
+void vte_terminal_set_alternate_screen_scroll(VteTerminal *terminal,
+					      gboolean scroll);
 
 /* Set the color scheme. */
 void vte_terminal_set_color_dim(VteTerminal *terminal,
diff -Nur -x '*.orig' -x '*~' vte/src/vte-private.h vte.new/src/vte-private.h
--- vte/src/vte-private.h	2008-08-13 16:21:04.000000000 -0700
+++ vte.new/src/vte-private.h	2008-08-28 09:23:40.000000000 -0700
@@ -313,6 +313,7 @@
 	gboolean scroll_on_output;
 	gboolean scroll_on_keystroke;
 	long scrollback_lines;
+	gboolean alternate_screen_scroll;
 
 	/* Cursor blinking. */
         VteTerminalCursorBlinkMode cursor_blink_mode;
