Debian #498295
GNOME #538344
Upstream commit r2090

--- trunk/src/vte.c	2008/08/25 14:57:20	2089
+++ trunk/src/vte.c	2008/09/01 11:14:44	2090
@@ -3171,7 +3171,8 @@
 _vte_terminal_connect_pty_write(VteTerminal *terminal)
 {
 	if (terminal->pvt->pty_channel == NULL) {
-		return;
+		terminal->pvt->pty_channel =
+			g_io_channel_unix_new(terminal->pvt->pty_master);
 	}
 
 	if (terminal->pvt->pty_output_source == VTE_INVALID_SOURCE) {
@@ -3238,10 +3239,12 @@
 	/* Close any existing ptys. */
 	if (terminal->pvt->pty_channel != NULL) {
 		g_io_channel_unref (terminal->pvt->pty_channel);
+		terminal->pvt->pty_channel = NULL;
 	}
 	if (terminal->pvt->pty_master != -1) {
 		_vte_pty_close(terminal->pvt->pty_master);
 		close(terminal->pvt->pty_master);
+		terminal->pvt->pty_master = -1;
 	}
 
 	/* Open the new pty. */
